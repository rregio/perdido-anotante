---
layout: default
---

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    {% comment %} O slug calculado aqui pode ser usado para outros fins no layout {% endcomment %}
    {% assign post_slug_header = page.url | remove_first: '/' | replace: '.html', '' | strip | downcase %}
    <h1 class="post-title p-name" itemprop="name headline">{{ page.title | escape }}</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">
        {{ page.date | date: site.minima.date_format | default: "%b %-d, %Y %H:%M" }}
      </time>
      {%- if page.author -%}
        • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">{{ page.author }}</span></span>
      {%- endif -%}
    </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    {{ content }}
  </div>

  <a class="u-url" href="{{ page.url | relative_url }}" hidden></a>
</article>

{% comment %} Código para Mensagem de Moderação {% endcomment %}
{% if page.url contains '?comment_status=moderation' or page.url contains '&comment_status=moderation' %}
  <div class="comment-moderation-message">
    <p>Seu comentário foi recebido e será publicado após moderação.</p>
    {% comment %} Opcional: Remover o parâmetro da URL via JavaScript para limpar {% endcomment %}
    <script>
      if (window.location.search.includes('comment_status=moderation')) {
        const url = new URL(window.location.href);
        url.searchParams.delete('comment_status');
        const newUrl = (url.searchParams.toString() === '') ? window.location.pathname : window.location.pathname + url.search;
        history.replaceState(null, '', newUrl + window.location.hash);
      }
    </script>
  </div>
{% endif %}
{% comment %} Fim do Código para Mensagem de Moderação {% endcomment %}


<section id="comments">
  
  {% comment %} --- CÓDIGO PARA EXIBIR COMENTÁRIOS APROVADOS --- {% endcomment %}
  {% comment %} Calculamos o slug corretamente aqui para usar na busca pelos dados dos comentários {% endcomment %}
  {% assign post_slug = page.url | remove_first: '/' | replace: '.html', '' | strip | downcase %}
  
  {% comment %} DEBUG TEMPORÁRIO: Deixamos comentadas as linhas de debug para limpar o HTML {% endcomment %}
  {% comment %} <p>DEBUG SLUG FINAL REFINADO: {{ post_slug | inspect }}</p> {% endcomment %}
  {% comment %} <p>DEBUG SITE.DATA.COMMENTS: {{ site.data.comments | inspect }}</p> {% endcomment %}
  {% comment %} FIM DEBUG TEMPORÁRIO {% endcomment %}

  {% comment %} Tentativa alternativa de acessar os dados dos comentários para este post antes do IF {% endcomment %}
  {% assign comments_for_post = site.data.comments[post_slug] %}

  {% comment %} DEBUG TEMPORÁRIO: Descomente as linhas abaixo para inspecionar o tamanho e o debug interno {% endcomment %}
  <p>DEBUG COMMENTS_FOR_POST SIZE: {{ comments_for_post | size | inspect }}</p>

  {% comment %} Verifica se existe a pasta de comentários para este slug e se tem pelo menos um comentário. {% endcomment %}
  {% comment %} Condição revisada para verificar se a variável existe E se tem tamanho maior que zero {% endcomment %}
  {% if comments_for_post and comments_for_post.size > 0 %} {# <<< NOVA CONDIÇÃO >>> #}
    
    <p>DEBUG INTERNO: IF BLOCK EXECUTADO!</p> {# <<< ESTE DEVE APARECER SE O IF FOR VERDADEIRO >>> #}

    {% comment %} Exibe o número de comentários (opcional) {% endcomment %}
    <h3>Comentários ({{ comments_for_post | size }})</h3>
    
    {% comment %} Obtém os comentários e ordena por data {% endcomment %}
    {% assign comments = comments_for_post | sort: 'date' %}

    <ul class="comment-list">
      {% comment %} Percorre cada arquivo .json na pasta do slug {% endcomment %}
      {% for comment in comments %}
        <li class="comment">
          <div class="comment-meta">
            <strong>{{ comment.name | escape }}</strong> em
            <time datetime="{{ comment.date | date_to_xmlschema }}">
              {{ comment.date | date: site.minima.date_format | default: "%b %-d, %Y %H:%M" }}
            </time>
          </div>
          <div class="comment-body">
            {{ comment.comment | markdownify }} {% comment %} Renderiza como Markdown {% endcomment %}
          </div>
        </li>
      {% endfor %}
    </ul>

  {% else %}
    {% comment %} Mensagem se não houver comentários {% endcomment %}
    <p>Ainda não há comentários para esta postagem.</p>
  {% endif %}
  {% comment %} --- FIM DO CÓDIGO PARA EXIBIR COMENTÁRIOS APROVADOS --- {% endcomment %}


  {% comment %} Formulário de comentários {% endcomment %}
  <h2>Deixe um Comentário</h2>
  <form name="comentario" method="POST" data-netlify="true" action="/.netlify/functions/receber-comentario">
    <input type="hidden" name="page-url" value="{{ page.url | absolute_url }}">
    <input type="hidden" name="post-title" value="{{ page.title }}">
    <p><label for="name">Nome:</label><br><input type="text" name="name" id="name" required></p>
    <p><label for="email">Email:</label><br><input type="email" name="email" id="email"></p>
    <p><label for="comment">Comentário:</label><br><textarea name="comment" id="comment" required></textarea></p>
    <p><button type="submit">Enviar Comentário</button></p>
  </form>

  {% comment %} Estilos do formulário de comentários {% endcomment %}
  <style>
    #comments { margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee; }
    #comments h2 { margin-bottom: 20px; }
    #comments label { display: block; margin-bottom: 5px; font-weight: bold; }
    #comments input[type="text"], #comments input[type="email"], #comments textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; box-sizing: border-box; }
    #comments button[type="submit"] { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px; }
    #comments button[type="submit"]:hover { background-color: #0056b3; }

    /* Estilos simples para a lista de comentários */
    .comment-list { list-style: none; padding: 0; }
    .comment { border: 1px solid #eee; padding: 15px; margin-bottom: 15px; border-radius: 5px; background-color: #f9f9f9; }
    .comment-meta { font-size: 0.9em; color: #555; margin-bottom: 5px; }
    .comment-body { margin-top: 10px; }
    .comment-body p:last-child { margin-bottom: 0; } /* Remove margem inferior do último parágrafo no comentário */
  </style>
</section>